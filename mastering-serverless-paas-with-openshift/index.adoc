:scrollbar:
:data-uri:
:toc2:
:imagesdir: images

== Mastering Serverless PaaS with OpenShift - Lab Guide

:numbered:
== Overview

This Lab Environment uses OpenShift 3.9, and Apache OpenWhisk, as open source Function-as-a-Service (FaaS) implementation for Platform-as-a-Service (PaaS) solutions on either Private, Hybrid and Public Clouds.

Apache OpenWhisk is designed to act as an asynchronous and loosely coupled execution environment that can run functions against external triggers. 
 
The initial configuration steps include:

* Configuring the access to OpenShift Container Platform Console and Web Console
* Accessing and managing Function-as-a-Service (faas) project inside OCP
* Configure OpenWhisk CLI to access faas project

After this initial step, we will try out main object of OpenWhisk such

* Actions
* Rules
* Triggers

In particular, we will do a step by step procedure to create and run functions as *Java Actions*, *Node Actions*, *Python Actions*


.Goal
* Create Functions and consume them at scale with OpenShift Container Platform
+

Required versions of products used:

[cols="1,1",options="header"]
|=======
|Product |Version
|OpenShift Container Platform |3.9.14
|Apache OpenWhisk | rhdemo-b7724ef
|Red Hat Enterprise Linux |7.4
|=======

=== OpenShift requirements

OpenShift Container Platform is the product built from the code of its upstream project Origin. 

Initially OpenShift will be deployed using the following appliance:
https://docs.openshift.com/container-platform/3.9/welcome/index.html[OpenShift 3.9.14]

To save time a pre-deployed appliance is provided of 4 Nodes, 1 Master and 3 App nodes

=== OpenWhisk requirements

OpenWhisk will run as containerized inside OpenShift, from official image on Docker Hub, properly tagged for OCP (rhdemo-b7724ef)

=== Environment

The demo environment consists of the following systems:

[cols="3",options="header"]
|=======
|Hostname              |Internal IP    |Description
|`workstation.example.com` |`192.168.0.5`  | Bastion host
|`master.example.com`  |`192.168.0.10` | Master
|`node01.example.com`  |`192.168.0.11` | Node 01
|`node02.example.com`  |`192.168.0.12` | Node 02
|`node03.example.com`  |`192.168.0.13` | Node 03
|=======


NOTE: HAProxy is running on the *workstation* machine.  This provides a level of port forwarding to allow access to the OpenShift console and the JBoss application and other services running on OpenShift to overcome some DNS and routing limitations in the underlying Ravello environment.  This includes port 80, 8443 and 8080-8085.

=== Access your Lab Environment


Every attendee gets her/his own lab environment. The lab environments are already started, to access your lab you need a unique *GUID* that is part of the hostnames.

The web browser of your laptop should default to https://www.opentlc.com/guidgrabber/guidgrabber.cgi. On this web page select the lab your attending and enter the activation key that will be given by the instructor. After submitting your input by clicking "Next" you will see the attendee welcome screen with the needed information:

* Your unique lab *GUID*
* A link to the lab guide 
* The hostnames / URLs you will access
* A link to the status page

=== To access your control host:

* Make sure you have your *GUID*
* Open a terminal session
* Log in to your control host:

----
ssh workstation-<GUID>.rhpds.opentlc.com
----

WARNING: *Replace <number> with the GUID assigned to your seat!*

Example: If your GUID is "12e4", do this:
----
ssh lab-user@workstation-12e4.rhpds.opentlc.com
----

TIP: The user will default to `lab-user` and SSH key authentication will be used automatically.
[IMPORTANT]
====
* It takes about 15-20 minutes for the demo to load completely and become accessible.
** Wait for the full demo to load, even if some of its systems are marked "Up."
* Watch for an email with information about how to access your demo environment.
** Make note of the email's contents: a list of hostnames, IP addresses, and your GUID.
** Whenever you see GUID in the demo instructions, replace it with the GUID provided in the email.
* You can get real-time updates of your demo environment at https://www.opentlc.com/rhpds-status.
====
+
[TIP]
Be mindful of the runtime of your demo environment! It may take you longer than the 3 hours allotted to complete the demo, so you may need to extend the runtime. This is especially important in later steps when you are building virtual machines. For information on how to extend runtime and lifetime, see https://www.opentlc.com/lifecycle.



== Lab OpenWhisk on OpenShift Architecture

image::lab-architecture.png[Lab Architecture]

. You will access the lab from your Summit Workstation provided.

. From Summit Workstation you will access the Lab Workstation machine to create and publish your functions

. Functions will run inside OpenWhisk runtimes spreaded across Pods on OpenShift







